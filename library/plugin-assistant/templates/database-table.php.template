<?php
/**
 * Database Table: {{table_name}}
 *
 * @package Plugin_Database
 */

// Prevent direct access.
if ( ! defined( 'ABSPATH' ) ) {
	exit;
}

/**
 * Create custom database table.
 */
function {{prefix}}_create_{{table_name}}_table(): void {
	global $wpdb;

	$table_name      = $wpdb->prefix . '{{table_name}}';
	$charset_collate = $wpdb->get_charset_collate();

	$sql = "CREATE TABLE $table_name (
{{columns}}
	PRIMARY KEY ({{primary_key}}){{indexes}}
) $charset_collate;";

	require_once ABSPATH . 'wp-admin/includes/upgrade.php';
	dbDelta( $sql );

	// Store table version.
	update_option( '{{prefix}}_{{table_name}}_db_version', '1.0.0' );
}

// Run on activation.
register_activation_hook( __FILE__, '{{prefix}}_create_{{table_name}}_table' );

/**
 * Check if table needs updating.
 */
function {{prefix}}_check_{{table_name}}_table(): void {
	$installed_version = get_option( '{{prefix}}_{{table_name}}_db_version' );
	$current_version   = '1.0.0';

	if ( $installed_version !== $current_version ) {
		{{prefix}}_create_{{table_name}}_table();
	}
}
add_action( 'plugins_loaded', '{{prefix}}_check_{{table_name}}_table' );
